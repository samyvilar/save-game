{% extends "base.html" %}

{% block title %} Search Results {% endblock %}

{% block css %}
    {% load static %}
    {% get_static_prefix as STATIC_PREFIX %}
    <link rel='stylesheet' href='{{ STATIC_PREFIX }}css/results.css' type='text/css' />
{% endblock %}

{% block js %}
<!-- 
<script type='text/javascript'>

function getvotedata(data){
    data = eval( '(' + data + ')' );  // Interpret string as json object.  Very unsafe, but does the job :)
    $("#votes").html(data['upvotes']+data['downvotes']);
    
}

$(document).ready(function(){

    /* This part uses ajax to get the necessary
       data from the db, given the user_id and uploaded_game_id */    
    $.ajax({
        type: "GET",
        url: "/getvotedata/",
        data: {'uploaded_game_id' : uploaded_game_id },
        async: false,
        success: getvotedata
    });


    $("#upvote").click(function(){
        $.ajax({
            async: false,
            success: getvotedata,
            url: "/getvotedata/",
            data: {'uploaded_game_id' : uploaded_game_id, 'upvote': 1} 

        });         
    });
    
	$("#downvote").click(function(){
		$.ajax({
			async: false,
			success: getvotedata,
			url: "/getvotedata/",
			data: {'uploaded_game_id' : uploaded_game_id, 'downvote': 1} 
		});         
    });

});
</script>
 -->

{% endblock %}
{% block nav %}
	{% if logged_in %}
		<div id='nav'>
		  <div style='width: 100%; float: left; text-align: center;'>
			<!-- This part needs to dynamically be loaded with the right username -->
			Welcome, <span style='color: red'>{{ fullname }}</span>
			
		  </div>
		  <div> &nbsp;
		  </div>
		  <div style='width: 100%; float: left;'>
			<a href='/'>Search</a> &nbsp; &nbsp; | &nbsp; &nbsp;
			<a href='/settings/'>Account Settings</a> &nbsp; &nbsp; | &nbsp; &nbsp;
			<a href='#'>Upload</a> &nbsp; &nbsp; | &nbsp; &nbsp;
			<a href='/signOut/'>Sign Off</a>
		  </div>
		</div>
	{% else %}
		<div id='nav'>
        	<div style='width: 100%; float: right;'>
          	  <a href='/signIn/'>Login</a> &nbsp; | &nbsp;
          	  <a href='/registration/'>Sign Up</a>
        	</div>
   	 	</div>
	{% endif %}
{% endblock %}

{% block content %} 
 <div id='top'>
    <div id='title'>
            <div class='t_c'> Save Data </div>
            <div class='t_c'> Game </div>
            <div class='t_c'> Platform </div>
            <div class='t_c'> Action </div>
   
    </div>
    <div style='width: 100%; float: left;'>
        <br />
    </div>
    {% if search_res %}
    	{% for member in search_res.object_list %}
			<div class="{% cycle 'gray' 'white' %}">
				<div class='one'>
					<a href="/gamepage/?uploaded_game_id={{ member.id }}">Filename</a>
				</div>
				<div class='one'>
					{{ member.game.title }}
				</div>
				<div class='one'>
					 {{ member.platform.name }}
				</div>
				<div class='one' style='font-size: 12px;'>
					<div style='width: 30%; float: left'>
						<a href="{{member.file}}">Download</a>
					</div>
					<div style='width: 30%; float: left'>
                    	<a href="/gamepage/?uploaded_game_id={{ member.id }}"> View Page </a>
                    </div>
					<div style='width: 30%; float: left'>
							<a href="#">Upvote</a>
							<br />
							<br />
							<a href="#">Downvote</a>
					</div>
					<div id = 'votes' style='font-size: 14px; width: 9%; float: left'>
					   {{ member.upvote }} <br /> <br /> {{ member.downvote }}
					</div>
				</div>
			</div>
		{% endfor %}
	{% endif %}	
</div>

{% endblock %}

{% block h_footer %}
    <div style='width: 100%; text-align:center; float: left; font-size: 22px;'>
    	{% if search_res %}
			{% if search_res.has_previous %}
				<a href="/results/?search={{qry|escape}}&page={{ search_res.previous_page_number }}">Previous</a>
			{% endif %}
			{% if ellipses1 %}
				 | <a href="/results/?search={{qry|escape}}&page=1">1</a> | ... 
			{% endif %}
			{% for p in page_list %}
				 | <a href="/results/?search={{qry|escape}}&page={{ p }}">{{ p }}</a> |
			{% endfor %}
			{% if ellipses2 %}
				... | <a href="/results/?search={{qry|escape}}&page={{ search_res.paginator.num_pages }}">{{ search_res.paginator.num_pages }}</a> |
			{% endif %}
			{% if search_res.has_next %}
				<a href="/results/?search={{qry|escape}}&page={{ search_res.next_page_number }}">Next</a>
			{% endif %}
		{% endif %}
    </div>
{% endblock %}



